<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>EXODUS — 갈라진 바다</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD + Babel (JSX transform) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- (선택) 아이콘 커스텀: 전역 등록 -->
    <script>
      // window.EXODUS_ICONS = { Bread: "https://example.com/bread.svg" };
    </script>
    <style>
      html,body,#root { height: 100%; }
      body { margin:0; background:#0b0a07; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- 앱 코드 (JS/JSX, TS 금지) -->
    <script type="text/babel" data-presets="env,react">
      const { useEffect, useState } = React;

      // --------- 유틸 (JS) ---------
      const clamp = (n, min = 0, max = 100) => Math.max(min, Math.min(max, n));
      const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

      // --------- 기본 아이콘 (간단 SVG) ---------
      const DefaultIcon = {
        Bread: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><path d=\"M8 28c0-10 10-18 24-18s24 8 24 18v12c0 6-6 12-12 12H20C14 52 8 46 8 40V28z\" fill=\"currentColor\"/></svg>
        ),
        Herb: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><path d=\"M12 44c12-12 28-12 40-24-6 16-22 22-28 28-6 6-8 6-12 6 2-4 2-6 0-10z\" fill=\"currentColor\"/></svg>
        ),
        Bandage: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><rect x=\"8\" y=\"28\" width=\"48\" height=\"8\" rx=\"4\" fill=\"currentColor\"/><circle cx=\"20\" cy=\"32\" r=\"2\" fill=\"#fff\"/><circle cx=\"28\" cy=\"32\" r=\"2\" fill=\"#fff\"/><circle cx=\"36\" cy=\"32\" r=\"2\" fill=\"#fff\"/><circle cx=\"44\" cy=\"32\" r=\"2\" fill=\"#fff\"/></svg>
        ),
        People: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><circle cx=\"20\" cy=\"20\" r=\"8\" fill=\"currentColor\"/><circle cx=\"44\" cy=\"20\" r=\"8\" fill=\"currentColor\"/><rect x=\"10\" y=\"32\" width=\"44\" height=\"16\" rx=\"8\" fill=\"currentColor\"/></svg>
        ),
        Stress: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><path d=\"M8 40c6-8 16-12 24-12s18 4 24 12\" stroke=\"currentColor\" strokeWidth=\"6\" fill=\"none\"/><circle cx=\"24\" cy=\"20\" r=\"4\" fill=\"currentColor\"/><circle cx=\"40\" cy=\"20\" r=\"4\" fill=\"currentColor\"/></svg>
        ),
        Chase: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><path d=\"M8 40l12-20h8l8 10h12l8 10H8z\" fill=\"currentColor\"/></svg>
        ),
        Wave: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><path d=\"M4 40c8 0 8-8 16-8s8 8 16 8 8-8 16-8 8 8 12 8v8H4z\" fill=\"currentColor\"/></svg>
        ),
        Lightning: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><path d=\"M28 4L12 36h14l-4 24 20-32H28z\" fill=\"currentColor\"/></svg>
        ),
        Compass: () => (
          <svg viewBox=\"0 0 64 64\" className=\"w-5 h-5\"><circle cx=\"32\" cy=\"32\" r=\"26\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\"/><path d=\"M44 20L28 28 20 44l16-8 8-16z\" fill=\"currentColor\"/></svg>
        ),
      };

      function GetIcon({ name, className = "w-5 h-5" }) {
        const custom = (typeof window !== "undefined" ? (window.EXODUS_ICONS && window.EXODUS_ICONS[name]) : undefined);
        if (custom) {
          if (typeof custom === "string") return <img src={custom} className={className} alt={name} />;
          if (typeof custom === "function") return custom({ className });
          if (React.isValidElement(custom)) return React.cloneElement(custom, { className });
        }
        const Comp = DefaultIcon[name];
        return <Comp />;
      }

      const DIFFICULTY_KEYS = ["쉬움", "보통", "어려움", "악몽"];

      const DIFF_PRESETS = {
        "쉬움": {
          desc: "자원 넉넉, 사건 완화, 자동 전진 1",
          init: { bread: 8, herbs: 5, bandage: 4, people: 220, stress: 12, chase: 15, maxDistance: 10 },
          mods: { baseChaseGain: 4, stressGainPerTurn: 2, eventMul: 0.8, autoAdvance: 1 },
          deckDelta: (ids) => [ids.prayer, ids.hide],
        },
        "보통": {
          desc: "기본 밸런스",
          init: { bread: 6, herbs: 4, bandage: 3, people: 200, stress: 15, chase: 20, maxDistance: 10 },
          mods: { baseChaseGain: 5, stressGainPerTurn: 3, eventMul: 1.0, autoAdvance: 1 },
        },
        "어려움": {
          desc: "사건↑, 추격 가속↑, 자동 전진 1",
          init: { bread: 5, herbs: 3, bandage: 2, people: 190, stress: 18, chase: 25, maxDistance: 11 },
          mods: { baseChaseGain: 6, stressGainPerTurn: 4, eventMul: 1.2, autoAdvance: 1 },
        },
        "악몽": {
          desc: "사건↑↑, 추격 가속↑↑, 자동 전진 0",
          init: { bread: 4, herbs: 2, bandage: 2, people: 180, stress: 20, chase: 28, maxDistance: 12 },
          mods: { baseChaseGain: 7, stressGainPerTurn: 5, eventMul: 1.4, autoAdvance: 0 },
        },
      };

      let autoId = 0;
      const cid = () => \`C\${autoId++}\`;

      function createCards() {
        const c = {};

        const add = (card) => {
          const id = cid();
          c[id] = { id, ...card };
          return id;
        };

        const bread = add({
          name: "누룩 없는 빵 배급",
          cost: 1,
          tint: "amber-400",
          text: "빵 -1 ➜ 스트레스 -8, 굶주림 사건 확률↓",
          canUse: (s) => s.bread > 0,
          use: (s) => ({ ...s, bread: s.bread - 1, stress: clamp(s.stress - 8), log: [
            \`빵을 배급했습니다. 스트레스가 줄었습니다.\`,
            ...s.log,
          ] }),
        });

        const herb = add({
          name: "약초 치료",
          cost: 1,
          tint: "emerald-400",
          text: "약초 -1 ➜ 질병/부상 피해 완화, 스트레스 -4",
          canUse: (s) => s.herbs > 0,
          use: (s) => ({ ...s, herbs: s.herbs - 1, stress: clamp(s.stress - 4), log: [
            \`약초로 치료했습니다. 피해가 줄어듭니다.\`,
            ...s.log,
          ] }),
        });

        const band = add({
          name: "붕대 감기",
          cost: 1,
          tint: "rose-300",
          text: "붕대 -1 ➜ 부상 사망 방지, 스트레스 -3",
          canUse: (s) => s.bandage > 0,
          use: (s) => ({ ...s, bandage: s.bandage - 1, stress: clamp(s.stress - 3), log: [
            \`붕대를 사용했습니다. 부상자 회복에 도움.\`,
            ...s.log,
          ] }),
        });

        const decoy = add({
          name: "미끼 작전",
          cost: 1,
          tint: "yellow-300",
          text: "추격 -10 (최소 0)",
          use: (s) => ({ ...s, chase: clamp(s.chase - 10), log: [
            \`미끼를 사용해 추격을 따돌렸습니다.\`,
            ...s.log,
          ] }),
        });

        const scout = add({
          name: "선발대 정찰",
          cost: 1,
          tint: "sky-300",
          text: "추격 -5, 스트레스 -5",
          use: (s) => ({ ...s, chase: clamp(s.chase - 5), stress: clamp(s.stress - 5), log: [
            \`정찰 성공! 안전 경로를 발견했습니다.\`,
            ...s.log,
          ] }),
        });

        const night = add({
          name: "야간 이동",
          cost: 1,
          tint: "indigo-300",
          text: "추격 -6, 스트레스 +4",
          use: (s) => ({ ...s, chase: clamp(s.chase - 6), stress: clamp(s.stress + 4), log: [
            \`밤을 틈타 이동했습니다. 추격이 줄었습니다(피로↑).\`,
            ...s.log,
          ] }),
        });

        const march = add({
          name: "빠른 행군",
          cost: 2,
          tint: "orange-300",
          text: "거리 +1, 스트레스 +6, 추격 +4",
          use: (s) => ({ ...s, distance: clamp(s.distance + 1, 0, s.maxDistance), stress: clamp(s.stress + 6), chase: clamp(s.chase + 4), log: [
            \`빠른 행군으로 더 전진했습니다.\`,
            ...s.log,
          ] }),
        });

        const hide = add({
          name: "모래언덕 은닉",
          cost: 1,
          tint: "amber-500",
          text: "추격 -8, 에너지 +1(최대 초과 불가)",
          use: (s) => ({ ...s, chase: clamp(s.chase - 8), energy: clamp(s.energy + 1, 0, s.maxEnergy), log: [
            \`모래언덕에 숨었습니다. 숨 고르기!\`,
            ...s.log,
          ] }),
        });

        const prayer = add({
          name: "기도",
          cost: 1,
          tint: "cyan-300",
          text: "스트레스 -10 (최소 0)",
          use: (s) => ({ ...s, stress: clamp(s.stress - 10), log: [
            \`기도로 마음이 평안해졌습니다.\`,
            ...s.log,
          ] }),
        });

        const inspire = add({
          name: "격려",
          cost: 0,
          tint: "emerald-300",
          text: "스트레스 -4",
          use: (s) => ({ ...s, stress: clamp(s.stress - 4), log: [
            \`격려의 말이 백성들에게 힘이 되었습니다.\`,
            ...s.log,
          ] }),
        });

        return { cards: c, ids: { bread, herb, band, decoy, scout, night, march, hide, prayer, inspire } };
      }

      function buildStartDeck(ids, diffKey) {
        const base = [
          ids.bread, ids.bread, ids.herb, ids.band,
          ids.decoy, ids.scout, ids.night,
          ids.march, ids.march, ids.hide,
          ids.prayer, ids.inspire, ids.inspire,
        ];
        const delta = DIFF_PRESETS[diffKey].deckDelta ? DIFF_PRESETS[diffKey].deckDelta(ids) : [];
        return [...base, ...delta];
      }

      function createGame(difficulty) {
        const { cards, ids } = createCards();
        const deck = buildStartDeck(ids, difficulty);
        const shuffled = shuffle(deck);
        const draw = [...shuffled];
        const hand = [];

        const preset = DIFF_PRESETS[difficulty];
        const init = preset.init || {};

        return {
          turn: 1,
          energy: 3,
          maxEnergy: 3,
          deck,
          discard: [],
          draw,
          hand,
          cards,

          bread: init.bread ?? 6,
          herbs: init.herbs ?? 4,
          bandage: init.bandage ?? 3,
          people: init.people ?? 200,
          lost: 0,
          stress: init.stress ?? 15,
          chase: init.chase ?? 20,
          distance: 0,
          maxDistance: init.maxDistance ?? 10,

          log: ["출발 준비가 끝났습니다. (탈출 시작)"],
          scene: "play",

          difficulty,
          mods: preset.mods,
        };
      }

      function shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function resolveEndTurnEvents(s) {
        let log = s.log;
        let { people, lost, stress, chase, bread, herbs, bandage } = s;

        const baseChaseGain = s.mods.baseChaseGain + Math.floor(s.distance / 3);
        chase = clamp(chase + baseChaseGain);

        stress = clamp(stress + s.mods.stressGainPerTurn);

        if (bread <= 0 && Math.random() < 0.4) {
          stress = clamp(stress + 8);
          log = ["식량이 부족해 사기가 떨어졌습니다 (+스트레스).", ...log];
        }

        const rawChance = 0.15 + stress / 200 + chase / 300;
        const eventChance = Math.min(rawChance * s.mods.eventMul, 0.6);
        if (Math.random() < eventChance) {
          const roll = Math.random();
          if (roll < 0.33) {
            let deaths = rnd(1, 5);
            if (herbs > 0) deaths = Math.max(0, deaths - 2);
            if (bandage > 0) deaths = Math.max(0, deaths - 1);
            people = Math.max(0, people - deaths);
            lost += deaths;
            stress = clamp(stress + 6);
            log = [
              deaths > 0 ? \`질병이 돌았습니다 (-\${deaths}명).\` : "질병이 돌았지만 큰 피해는 없었습니다.",
              ...log,
            ];
          } else if (roll < 0.66) {
            const leave = rnd(0, 4);
            people = Math.max(0, people - leave);
            lost += leave;
            stress = clamp(stress + 5);
            log = [
              leave > 0 ? \`내분이 발생했습니다 (-\${leave}명 이탈).\` : "사소한 다툼이 있었지만 수습했습니다.",
              ...log,
            ];
          } else {
            chase = clamp(chase + rnd(5, 12));
            stress = clamp(stress + 4);
            log = ["파라오의 병거가 속도를 냅니다 (추격↑).", ...log];
          }
        }

        const autoAdvance = s.mods.autoAdvance;
        const distance = clamp(s.distance + autoAdvance, 0, s.maxDistance);

        return { ...s, people, lost, stress, chase, bread, herbs, bandage, distance, log };
      }

      function calcScore(s) {
        const survivors = s.people;
        const speed = Math.max(0, (12 + (s.difficulty === "악몽" ? 2 : 0)) - s.turn);
        const safety = 100 - s.chase;
        const morale = 100 - s.stress;
        const score = survivors * 2 + speed * 100 + safety * 5 + morale * 3;
        return Math.max(0, Math.round(score));
      }

      function saveAndRank(score) {
        const key = "exodus_scores_v1";
        const arr = JSON.parse(localStorage.getItem(key) || "[]");
        arr.push(score);
        arr.sort((a, b) => b - a);
        localStorage.setItem(key, JSON.stringify(arr));
        const idx = arr.indexOf(score);
        const n = arr.length;
        const percentileTop = Math.round((1 - idx / n) * 10000) / 100;
        return { rank: idx + 1, total: n, percentileTop, board: arr.slice(0, 10) };
      }

      function drawUpTo(state, n = 5) {
        let s = { ...state };
        while (s.hand.length < n) {
          if (s.draw.length === 0) {
            if (s.discard.length === 0) break;
            s.draw = shuffle(s.discard);
            s.discard = [];
          }
          const id = s.draw.shift();
          if (id == null) break;
          s.hand.push(id);
        }
        return s;
      }

      function startTurn(state) {
        let s = { ...state, energy: state.maxEnergy };
        s = drawUpTo(s, 5);
        return s;
      }

      function endTurn(state) {
        let s = { ...state, turn: state.turn + 1, energy: state.maxEnergy };
        s.discard = [...s.discard, ...s.hand];
        s.hand = [];
        s = resolveEndTurnEvents(s);
        s = drawUpTo(s, 5);

        if (s.chase >= 100 || s.people <= 0) {
          return { ...s, scene: "defeat", log: ["이집트 군대에게 추격당했습니다...", ...s.log] };
        }
        if (s.distance >= s.maxDistance) {
          return { ...s, scene: "victory" };
        }
        return s;
      }

      function playCard(state, id) {
        const card = state.cards[id];
        if (!card) return state;
        if (state.energy < card.cost) return state;
        if (card.canUse && !card.canUse(state)) return state;

        let s = { ...state, energy: state.energy - card.cost };
        s = card.use(s);

        { // 한 장만 제거
          const hand = [...s.hand];
          const idx = hand.indexOf(id);
          if (idx !== -1) hand.splice(idx, 1);
          s.hand = hand;
        }
        s.discard = [id, ...s.discard];
        return s;
      }

      function Bar({ label, val, max = 100, color }) {
        const pct = Math.round((val / max) * 100);
        return (
          <div className="w-full">
            <div className="flex items-center justify-between text-xs text-amber-100/90">
              <span className="tracking-wider">{label}</span>
              <span className="font-semibold">{val}/{max}</span>
            </div>
            <div className="h-2 w-full rounded-full bg-amber-900/40 overflow-hidden">
              <div className={`h-2 ${color}`} style={{ width: `${pct}%` }} />
            </div>
          </div>
        );
      }

      function MeterRow({ s }) {
        return (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
            <div className="flex gap-2 items-center"><GetIcon name="People" /><Bar label="인구" val={s.people} max={300} color="bg-amber-300"/></div>
            <div className="flex gap-2 items-center"><GetIcon name="Stress" /><Bar label="스트레스" val={s.stress} color="bg-rose-400"/></div>
            <div className="flex gap-2 items-center"><GetIcon name="Chase" /><Bar label="추격" val={s.chase} color="bg-yellow-300"/></div>
            <div className="flex gap-2 items-center"><GetIcon name="Compass" /><Bar label="거리" val={s.distance} max={s.maxDistance} color="bg-orange-400"/></div>
            <div className="flex gap-2 items-center"><GetIcon name="Lightning" /><Bar label="에너지" val={s.energy} max={s.maxEnergy} color="bg-emerald-400"/></div>
          </div>
        );
      }

      function ResourcePills({ s }) {
        const pill = (icon, label, val, cls) => (
          <div className={`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${cls}`}>
            <span className="opacity-90">{icon}</span>
            <span>{label}</span>
            <span className="opacity-90">{val}</span>
          </div>
        );
        return (
          <div className="flex flex-wrap gap-2">
            {pill(<GetIcon name="Bread"/>, "빵", s.bread, "bg-amber-300/20 text-amber-100 border border-amber-300/30")}
            {pill(<GetIcon name="Herb"/>, "약초", s.herbs, "bg-emerald-300/20 text-emerald-100 border border-emerald-300/30")}
            {pill(<GetIcon name="Bandage"/>, "붕대", s.bandage, "bg-rose-300/20 text-rose-100 border border-rose-300/30")}
            <div className="flex items-center gap-2 text-amber-100/80 text-xs">
              <span>턴</span><span className="font-bold">{s.turn}</span>
            </div>
          </div>
        );
      }

      function MapTrack({ s }) {
        const nodes = Array.from({ length: s.maxDistance + 1 }, (_, i) => i);
        return (
          <div className="flex items-center justify-between gap-2 w-full">
            {nodes.map((i) => (
              <div key={i} className={`relative w-6 h-6 sm:w-7 sm:h-7 rounded-full flex items-center justify-center text-[10px] sm:text-xs font-bold 
                ${i <= s.distance ? "bg-amber-300 text-amber-950" : "bg-amber-950/40 text-amber-100/60"}`}>
                {i}
                {i === s.maxDistance && (
                  <div className="absolute -top-3 -right-3 text-sky-300"><GetIcon name="Wave"/></div>
                )}
              </div>
            ))}
          </div>
        );
      }

      const TINT_BG = {
        "amber-400": "bg-amber-400",
        "emerald-400": "bg-emerald-400",
        "rose-300": "bg-rose-300",
        "yellow-300": "bg-yellow-300",
        "sky-300": "bg-sky-300",
        "indigo-300": "bg-indigo-300",
        "orange-300": "bg-orange-300",
        "amber-500": "bg-amber-500",
        "cyan-300": "bg-cyan-300",
        "emerald-300": "bg-emerald-300",
        "amber-300": "bg-amber-300",
      };

      function CardView({ card, disabled, onPlay }) {
        const tint = card.tint || "amber-300";
        const tintClass = TINT_BG[tint];
        return (
          <button disabled={disabled} onClick={onPlay}
            className={`group relative w-44 h-56 rounded-2xl p-3 text-left shadow-lg 
              bg-amber-950/40 border border-amber-700/40 hover:border-amber-400/50 transition 
              ${disabled ? "opacity-50 cursor-not-allowed" : "hover:-translate-y-0.5"}`}>
            <div className={`absolute inset-x-0 -top-1 h-1 rounded-t-2xl ${tintClass}`}></div>
            <div className="text-amber-100 font-bold text-sm pr-8 leading-tight">{card.name}</div>
            <div className="absolute top-3 right-3 w-8 h-8 rounded-full bg-amber-900/60 border border-amber-600/50 flex items-center justify-center text-amber-100 font-extrabold">{card.cost}</div>
            <div className="mt-3 text-[13px] text-amber-100/90 leading-snug">{card.text}</div>
            <div className="absolute bottom-3 left-3 text-[10px] uppercase tracking-wider text-amber-200/60">Action</div>
          </button>
        );
      }

      function Log({ s }) {
        return (
          <div className="h-40 overflow-auto rounded-xl p-3 bg-amber-950/40 border border-amber-700/40 text-amber-100 text-sm space-y-2">
            {s.log.map((l, i) => (
              <div key={i} className="opacity-90">• {l}</div>
            ))}
          </div>
        );
      }

      function TopBar() {
        return (
          <div className="flex items-center justify-between">
            <div className="text-amber-100 text-xl sm:text-2xl font-extrabold tracking-wide flex items-center gap-2">
              <span>EXODUS</span>
              <span className="text-amber-300/90">/ 갈라진 바다</span>
            </div>
            <div className="text-amber-200/70 text-xs sm:text-sm">덱빌딩 로그라이크 웹게임 프로토타입</div>
          </div>
        );
      }

      function runInternalTests() {
        try {
          const assert = (cond, msg) => { if (!cond) throw new Error(msg); };
          const g = createGame("보통");
          const arr = [1,2,3,4,5];
          const sh = shuffle(arr);
          console.log("✅ Smoke OK", g.deck.length, sh.length);
        } catch (e) { console.error("❌ Smoke NG", e); }
      }

      function App() {
        const savedDiff = (typeof window !== "undefined" && (localStorage.getItem("exodus_diff"))) || "보통";
        const [difficulty, setDifficulty] = useState(savedDiff);
        const [state, setState] = useState({ scene: "menu" });
        const [result, setResult] = useState(null);

        const startGame = () => {
          const g = createGame(difficulty);
          setState(startTurn(g));
          setResult(null);
          if (typeof window !== "undefined") localStorage.setItem("exodus_diff", difficulty);
        };

        useEffect(() => { runInternalTests(); }, []);

        useEffect(() => {
          if (state.scene === "victory") {
            const score = calcScore(state);
            const { percentileTop, rank, total, board } = saveAndRank(score);
            setResult({ score, percentile: percentileTop, rank, total, board });
          }
        }, [state.scene]);

        const play = (id) => setState((s) => playCard(s, id));
        const end = () => setState((s) => endTurn(s));
        const canPlay = (c) => state.energy >= c.cost && (!c.canUse || c.canUse(state));

        const desertBg = "bg-gradient-to-b from-amber-950 via-amber-900 to-amber-800";
        const seaBg = "bg-gradient-to-b from-sky-900 via-sky-700 to-sky-600";

        if (state.scene === "menu") {
          return (
            <div className={`min-h-screen ${desertBg} p-6 sm:p-8`}>
              <div className="max-w-6xl mx-auto space-y-8">
                <TopBar />
                <div className="grid lg:grid-cols-2 gap-8 items-center">
                  <div className="space-y-6">
                    <h1 className="text-amber-100 text-3xl sm:text-4xl font-extrabold">모세와 함께 홍해로</h1>
                    <p className="text-amber-100/90 leading-relaxed">
                      이집트의 추격을 피해 백성을 이끌고 홍해까지 전진하세요.
                    </p>
                    <div className="space-y-2">
                      <div className="text-amber-200/80 text-sm">난이도</div>
                      <div className="flex flex-wrap gap-2">
                        {DIFFICULTY_KEYS.map((k) => (
                          <button key={k}
                            onClick={() => setDifficulty(k)}
                            className={`px-3 py-2 rounded-xl text-sm border ${k === difficulty ? "bg-amber-300 text-amber-950 border-amber-400" : "bg-amber-950/30 text-amber-100 border-amber-700/40 hover:border-amber-400/40"}`}>
                            {k}
                          </button>
                        ))}
                      </div>
                      <div className="text-amber-200/70 text-xs">{DIFF_PRESETS[difficulty].desc}</div>
                    </div>
                    <button onClick={startGame} className="px-5 py-3 rounded-2xl bg-amber-300 text-amber-950 font-extrabold shadow hover:shadow-lg">
                      여정 시작
                    </button>
                  </div>
                  <div className="rounded-3xl border border-amber-700/40 p-6 bg-amber-950/30">
                    <div className="aspect-video rounded-2xl bg-amber-900/50 flex items-center justify-center text-amber-200/70">
                      시연 화면
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        }

        if (state.scene === "victory") {
          return (
            <div className={`min-h-screen ${seaBg} p-6 sm:p-8`}>
              <div className="max-w-6xl mx-auto space-y-6">
                <div className="flex items-center justify-between">
                  <div className="text-sky-100 text-2xl sm:text-3xl font-extrabold tracking-wide flex items-center gap-2">
                    <span>홍해가 갈라졌습니다!</span>
                    <GetIcon name="Wave" />
                  </div>
                  <button onClick={startGame} className="px-4 py-2 rounded-xl bg-sky-300 text-sky-950 font-bold">다시 도전</button>
                </div>
                {result && <div className="text-sky-100">점수: {result.score} · 상위 {result.percentile.toFixed(2)}%</div>}
              </div>
            </div>
          );
        }

        if (state.scene === "defeat") {
          return (
            <div className={`min-h-screen ${desertBg} p-6 sm:p-8`}>
              <div className="max-w-4xl mx-auto space-y-6">
                <div className="text-amber-100 text-2xl sm:text-3xl font-extrabold">패배… 추격을 피하지 못했습니다</div>
                <button onClick={() => startGame()} className="px-5 py-3 rounded-2xl bg-amber-300 text-amber-950 font-extrabold">다시 시도</button>
              </div>
            </div>
          );
        }

        return (
          <div className={`min-h-screen ${desertBg} p-6 sm:p-8`}>
            <div className="max-w-7xl mx-auto space-y-6">
              <TopBar />
              <div className="grid lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2 space-y-4">
                  <div className="rounded-3xl p-4 bg-amber-950/30 border border-amber-700/40">
                    <div className="text-amber-200/80 text-sm mb-2">경로 진행</div>
                  </div>
                </div>
                <div className="space-y-3">
                  <div className="rounded-3xl p-4 bg-amber-950/30 border border-amber-700/40">
                    <div className="text-amber-200/80 text-sm mb-2">사건 로그</div>
                    <div className="h-40 overflow-auto text-amber-100 text-sm space-y-2">
                      {state.log && state.log.map ? state.log.map((l, i) => (<div key={i} className="opacity-90">• {l}</div>)) : null}
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <button onClick={() => setState(startTurn)} className="px-4 py-2 rounded-xl bg-amber-300 text-amber-950 font-bold">손패 보충</button>
                    <button onClick={end} className="px-4 py-2 rounded-xl bg-amber-100/90 text-amber-950 font-bold border border-amber-700/40">턴 종료</button>
                  </div>
                </div>
              </div>
              <div className="rounded-3xl p-4 bg-amber-950/30 border border-amber-700/40">
                <div className="text-amber-200/80 text-sm mb-3">손패 (에너지 {state.energy}/{state.maxEnergy})</div>
                <div className="flex flex-wrap gap-3">
                  {state.hand && state.hand.map ? state.hand.map((id, idx) => (
                    <div key={\`\${id}-\${idx}\`} className="w-44 h-56 rounded-2xl p-3 bg-amber-900/40 border border-amber-700/40"></div>
                  )) : null}
                </div>
                <div className="mt-3 text-amber-200/70 text-xs">드로우 {state.draw ? state.draw.length : 0} · 버림 {state.discard ? state.discard.length : 0}</div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
